<!-- build time:Thu Dec 21 2023 00:05:21 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://coloraven.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://coloraven.github.io/atom.xml"><link rel="alternate" type="application/json" href="https://coloraven.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CMicrosoft%20YaHei:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://coloraven.github.io/2021/12/%E6%9F%90%E6%88%90%E5%9C%A8%E7%BA%BF%E8%8E%B7%E5%8F%96%E7%9C%9F%E5%AE%9E%E8%A7%86%E9%A2%91%E5%9C%B0%E5%9D%80%E3%80%90%E8%BD%AC%E8%BD%BD%E5%A4%87%E4%BB%BD%E3%80%91/"><title>某成在线获取真实视频地址【转载备份】 | Black Elk = = 潛龍勿用</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">某成在线获取真实视频地址【转载备份】</h1><div class="meta"><span class="item" title="创建时间：2021-12-06 23:17:05"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-06T23:17:05+08:00">2021-12-06</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Black Elk</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/208778/30/2162/1090197/614f238cE12160353/feec03acac8e6b60.jpg"></li><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/166937/29/21230/5649134/614f31fdE5bd9ef72/aafa4c5b4e0bdb24.png"></li><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/107132/18/15029/448305/614f3c5aE5ee14a19/4be94c7946f3ac84.jpg"></li><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/211565/24/2112/853775/614f2f6bE323daee0/6ee70e5cd4e92b3d.jpg"></li><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/203090/12/6791/9521324/614f3546E29dd0601/0d748993d42f2359.jpg"></li><li class="item" data-background-image="https://dd-static.jd.com/ddimg/jfs/t1/208935/3/2147/2027051/614f2343E61bea107/a482830fa780ccad.png"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://coloraven.github.io/2021/12/%E6%9F%90%E6%88%90%E5%9C%A8%E7%BA%BF%E8%8E%B7%E5%8F%96%E7%9C%9F%E5%AE%9E%E8%A7%86%E9%A2%91%E5%9C%B0%E5%9D%80%E3%80%90%E8%BD%AC%E8%BD%BD%E5%A4%87%E4%BB%BD%E3%80%91/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="黑麋鹿"><meta itemprop="description" content="潛龍勿用, 折腾之路"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h2 id="0x1-f12-寻找关键点"><a class="anchor" href="#0x1-f12-寻找关键点">#</a> 0x1 F12 寻找关键点</h2><blockquote></blockquote><p>在播放视频视频的过程过，按 F12 查看网络发送的请求，立刻发现了一个关键的地址</p><p><img data-src="2021-12-06T231854.png" alt="2021-12-06T231854"></p><p>直接浏览器中打开这个地址会下载一个 <code>.ev1</code> 的文件，没见过这中文件格式的小刘同学，决定百度搜索一下这是个啥格式：</p><blockquote><p>EV1 文件是一种加密文件。下载文件查看器查看文件。</p></blockquote><p>既然需要解密播放工具，那就先在论坛搜搜看。于是机智的刘同学发现了论坛上有这样一个有用的帖子：<a target="_blank" rel="noopener" href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1332673"><strong>ev1 百家云视频解密工具、ev1 视频提取工具，支持 Windows、MacOS、Linux</strong></a></p><p>通过使用该工具解密，转为 flv 格式，最终视频成功播放。</p><p>这样的话所有的视频只要在播放的时候获取到这个链接复制到浏览器下载最后提取就可以了。</p><h2 id="0x2-通过-api-获取视频地址"><a class="anchor" href="#0x2-通过-api-获取视频地址">#</a> 0x2 通过 API 获取视频地址</h2><p><img data-src="2021-12-06T231910.png" alt="2021-12-06T231910"></p><pre><code>请求URL：https://www.xxxjiayun.com/vod/video/getAllFormatPlayUrl
请求方法：GET
参数：
vid: 73323428    // 这里的vid其实是视频的url属性
sid: 
render: jsonp
client_type: flash
ver: 2
token: xxxxxxxx-xxxxxx-xxxxxx// 修饰后 播放器token
callback: jQueryxxxxxxxxxxxx_162xxxxx// 修饰后 感觉这个参数没啥用
_: 16270000005// 修饰后 时间戳
</code></pre><p>返回的数据 (非完整)：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">jQuery193_1164</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string">"code"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">"duration"</span><span class="token operator">:</span> <span class="token string">"2055"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">"format"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"superHD"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"超清"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token string">"vod_default_definition"</span><span class="token operator">:</span> <span class="token string">"superHD"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string">"playback_default_definition"</span><span class="token operator">:</span> <span class="token string">"superHD"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string">"all_format_play_info"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token string">"ev1"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">"superHD"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>          <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"超清"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>          <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">70459130</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token string">"cdn_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token string">"cdn"</span><span class="token operator">:</span> <span class="token string">"hw4jd"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"high"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token string">"duration"</span><span class="token operator">:</span> <span class="token number">2055</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token string">"height"</span><span class="token operator">:</span> <span class="token number">540</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token string">"oversea"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">70459130</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token string">"width"</span><span class="token operator">:</span> <span class="token number">960</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token string">"weight"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token string">"enc_url"</span><span class="token operator">:</span> <span class="token string">"bjcloudvod://xxx-xxx"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token string">"cdn"</span><span class="token operator">:</span> <span class="token string">"jd4jd"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"high"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token string">"duration"</span><span class="token operator">:</span> <span class="token number">2055</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token string">"height"</span><span class="token operator">:</span> <span class="token number">540</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token string">"oversea"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">70459130</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token string">"width"</span><span class="token operator">:</span> <span class="token number">960</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token string">"weight"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token string">"enc_url"</span><span class="token operator">:</span> <span class="token string">"bjcloudvod://xxx-xxx"</span></pre></td></tr><tr><td data-num="39"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token string">"cdn"</span><span class="token operator">:</span> <span class="token string">"al4jd"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"high"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token string">"duration"</span><span class="token operator">:</span> <span class="token number">2055</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token string">"height"</span><span class="token operator">:</span> <span class="token number">540</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token string">"oversea"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">70459130</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token string">"width"</span><span class="token operator">:</span> <span class="token number">960</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token string">"weight"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token string">"enc_url"</span><span class="token operator">:</span> <span class="token string">"bjcloudvod://xxx-xxx"</span></pre></td></tr><tr><td data-num="50"></td><td><pre>          <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>      <span class="token string">"mp4"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token string">"superHD"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>          <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"超清"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>          <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">68700179</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>          <span class="token string">"cdn_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token string">"cdn"</span><span class="token operator">:</span> <span class="token string">"hw4jd"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token string">"definition"</span><span class="token operator">:</span> <span class="token string">"high"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token string">"duration"</span><span class="token operator">:</span> <span class="token number">2055</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token string">"height"</span><span class="token operator">:</span> <span class="token number">540</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token string">"oversea"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">68700179</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token string">"width"</span><span class="token operator">:</span> <span class="token number">960</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token string">"weight"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token string">"enc_url"</span><span class="token operator">:</span> <span class="token string">"bjcloudvod://xxx-xxx"</span></pre></td></tr><tr><td data-num="68"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>观察这个返回的数据我们发现了关键的内容 <strong>超清</strong>， <strong>ev1</strong>，<strong>mp4</strong> ，里面的 <code>enc_url</code> 又是个加密的内容。凭借多年 ** 的经验，机智的小刘认为这个又是 MP4 又是超清的，加密内容绝对不简单，于是小刘决定尝试解密这个 <code>bjcloudvod</code> 链接。</p><p>在 F12 中搜索 <code>bjcloudvod</code> , 找到了解码的关键代码：</p><p><img data-src="2021-12-06T232019.png" alt="2021-12-06T232019"></p><p>这里懒惰的小刘同学决定通过 python 执行这段 js 代码。将代码转换一下写法：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> execjs</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>js_code <span class="token operator">=</span> execjs<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="4"></td><td><pre>function decodeUrl(url) &#123;</pre></td></tr><tr><td data-num="5"></td><td><pre>  var prefix = 'bjcloudvod://';</pre></td></tr><tr><td data-num="6"></td><td><pre>  if ('' == url || url.indexOf(prefix) !== 0) &#123;</pre></td></tr><tr><td data-num="7"></td><td><pre>    return;</pre></td></tr><tr><td data-num="8"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="9"></td><td><pre>  url = url.slice(prefix.length, url.length).replace(/-/g, '+').replace(/_/g, '/');</pre></td></tr><tr><td data-num="10"></td><td><pre>  var pad = url.length % 4;</pre></td></tr><tr><td data-num="11"></td><td><pre>  if (pad == 2) &#123;</pre></td></tr><tr><td data-num="12"></td><td><pre>    url += '==';</pre></td></tr><tr><td data-num="13"></td><td><pre>  &#125; else if (pad == 3) &#123;</pre></td></tr><tr><td data-num="14"></td><td><pre>    url += '=';</pre></td></tr><tr><td data-num="15"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="16"></td><td><pre>  url = _decode(url);</pre></td></tr><tr><td data-num="17"></td><td><pre>  var factor = url.charCodeAt(0);</pre></td></tr><tr><td data-num="18"></td><td><pre>  var c = factor % 8;</pre></td></tr><tr><td data-num="19"></td><td><pre>  url = url.slice(1, url.length);</pre></td></tr><tr><td data-num="20"></td><td><pre>  var result = [];</pre></td></tr><tr><td data-num="21"></td><td><pre>  for (var i = 0, char; char = url[i]; i++) &#123;</pre></td></tr><tr><td data-num="22"></td><td><pre>    var step = i % 4 * c + i % 3 + 1;</pre></td></tr><tr><td data-num="23"></td><td><pre>    result.push(String.fromCharCode(char.charCodeAt(0) - step));</pre></td></tr><tr><td data-num="24"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="25"></td><td><pre>  return result.join('');</pre></td></tr><tr><td data-num="26"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>var _PADCHAR = '=', _ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/', _VERSION = '1.0';</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>function _getbyte64(s, i) &#123;</pre></td></tr><tr><td data-num="31"></td><td><pre>  var idx = _ALPHA.indexOf(s.charAt(i));</pre></td></tr><tr><td data-num="32"></td><td><pre>  if (idx === -1) &#123;</pre></td></tr><tr><td data-num="33"></td><td><pre>    throw 'Cannot decode base64';</pre></td></tr><tr><td data-num="34"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="35"></td><td><pre>  return idx;</pre></td></tr><tr><td data-num="36"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>function _decode(s) &#123;</pre></td></tr><tr><td data-num="39"></td><td><pre>  var pads = 0, i, b10, imax = s.length, x = [];</pre></td></tr><tr><td data-num="40"></td><td><pre>  s = String(s);</pre></td></tr><tr><td data-num="41"></td><td><pre>  if (imax === 0) &#123;</pre></td></tr><tr><td data-num="42"></td><td><pre>    return s;</pre></td></tr><tr><td data-num="43"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="44"></td><td><pre>  if (imax % 4 !== 0) &#123;</pre></td></tr><tr><td data-num="45"></td><td><pre>    throw 'Cannot decode base64';</pre></td></tr><tr><td data-num="46"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="47"></td><td><pre>  if (s.charAt(imax - 1) === _PADCHAR) &#123;</pre></td></tr><tr><td data-num="48"></td><td><pre>    pads = 1;</pre></td></tr><tr><td data-num="49"></td><td><pre>    if (s.charAt(imax - 2) === _PADCHAR) &#123;</pre></td></tr><tr><td data-num="50"></td><td><pre>      pads = 2;</pre></td></tr><tr><td data-num="51"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num="52"></td><td><pre>    imax -= 4;</pre></td></tr><tr><td data-num="53"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="54"></td><td><pre>  for (i = 0; i &lt; imax; i += 4) &#123;</pre></td></tr><tr><td data-num="55"></td><td><pre>    b10 = _getbyte64(s, i) &lt;&lt; 18 | _getbyte64(s, i + 1) &lt;&lt; 12 | _getbyte64(s, i + 2) &lt;&lt; 6 | _getbyte64(s, i + 3);</pre></td></tr><tr><td data-num="56"></td><td><pre>    x.push(String.fromCharCode(b10 >> 16, b10 >> 8 &amp; 255, b10 &amp; 255));</pre></td></tr><tr><td data-num="57"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="58"></td><td><pre>  switch (pads) &#123;</pre></td></tr><tr><td data-num="59"></td><td><pre>    case 1:</pre></td></tr><tr><td data-num="60"></td><td><pre>      b10 = _getbyte64(s, i) &lt;&lt; 18 | _getbyte64(s, i + 1) &lt;&lt; 12 | _getbyte64(s, i + 2) &lt;&lt; 6;</pre></td></tr><tr><td data-num="61"></td><td><pre>      x.push(String.fromCharCode(b10 >> 16, b10 >> 8 &amp; 255));</pre></td></tr><tr><td data-num="62"></td><td><pre>      break;</pre></td></tr><tr><td data-num="63"></td><td><pre>    case 2:</pre></td></tr><tr><td data-num="64"></td><td><pre>      b10 = _getbyte64(s, i) &lt;&lt; 18 | _getbyte64(s, i + 1) &lt;&lt; 12;</pre></td></tr><tr><td data-num="65"></td><td><pre>      x.push(String.fromCharCode(b10 >> 16));</pre></td></tr><tr><td data-num="66"></td><td><pre>      break;</pre></td></tr><tr><td data-num="67"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num="68"></td><td><pre>  return x.join('');</pre></td></tr><tr><td data-num="69"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="70"></td><td><pre>"""<span class="token punctuation">)</span></pre></td></tr></table></figure><p>尝试用上面的加密内容测试这个解密方法：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre>encodeStr <span class="token operator">=</span> <span class="token string">"bjcloudvod://xxx-xxxx"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> encodeStr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 输出： https://dal4jd-video.baijiayun.com/8xxxxd4ca0/60x756/00-x-upload/video/xxxxxx.mp4</span></pre></td></tr></table></figure><p>居然直接获取到了视频的 MP4 地址！</p><p>机智的小刘可高兴坏了，这样的话通过 <code>getAllFormatPlayUrl</code> 获取视频直连，再用 urllib3 下载到本地就 OK 了。接下来就是构建 <code>getAllFormatPlayUrl</code> API 需要的参数就可以批量下载视频了～</p><h2 id="0x3-深入探究-getallformatplayurl"><a class="anchor" href="#0x3-深入探究-getallformatplayurl">#</a> 0x3 深入探究 getAllFormatPlayUrl</h2><blockquote><p>机智的小刘同学认为：能用 F12 解决的问题就坚决不用别的。</p></blockquote><p>再次分析需要传递的参数：</p><pre><code>vid: 73323428    // 这里的vid其实是视频的url属性
sid: 
render: jsonp
client_type: flash
ver: 2
token: xxxxxxxx-xxxxxx-xxxxxx// 修饰后 播放器token
callback: jQueryxxxxxxxxxxxx_162xxxxx// 修饰后 感觉这个参数没啥用
_: 16270000005// 修饰后 时间戳
</code></pre><p>关键的参数就只有两个 <code>vid</code> 和 <code>token</code> ，“__” 值为时间戳，可以在发送请求时候再自动生成。</p><h3 id="0x31-获取-token"><a class="anchor" href="#0x31-获取-token">#</a> 0x3.1 获取 token</h3><p>通过搜索 token 的值，机智的小刘同学又发现了一个 API：</p><ol><li>请求 URL:<span class="exturl" data-url="aHR0cHM6Ly93d3cueHh4eHhna3QuY29t">https://www.xxxxxgkt.com</span>:xxxx/web/bjvod/videoPlayerToken</li><li>请求方法: POST</li><li t:="" 1600000000633,="" 时间戳="" courseid:="" “15726cccc6_cxxxxx3-cxxx-xxxx-xxxx-xxxxxxxx”,="" 课程="" idexpires_in:="" 0,video_id:="" “2738000”="" 视频="" url="" 参数="">请求参数：</li></ol><p>返回：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"ts"</span><span class="token punctuation">:</span><span class="token number">1600000004</span><span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token string">"token"</span><span class="token punctuation">:</span><span class="token string">"xxxxxxxxxx-xxxxxxxxxxxx-xxxxx"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>这里说明一下，这个方法和我当时用的 API 不一样，我用的是 videoPlayerToken 这个 API，但是都可以获取到 token。后续 python 方法我还是使用的 videoPlayerToken。videoPlayerToken 需要购买课程才能调用。</p></blockquote><p>直接通过视频 ID 和时间戳就能获取到 token！机智的小刘同学觉得成功就在咫尺！</p><h3 id="0x32-构建时间戳"><a class="anchor" href="#0x32-构建时间戳">#</a> 0x3.2 构建时间戳</h3><p>经过简单的百度搜索，小刘同学获取到了 API 中时间戳的构建方法：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="0x33-用-python-实现-getallformatplayurl-和-playertoken"><a class="anchor" href="#0x33-用-python-实现-getallformatplayurl-和-playertoken">#</a> 0x3.3 用 python 实现 getAllFormatPlayUrl 和 playerToken</h3><p>自学了一段 python 时间的小刘同学，决定用 python 的 <code>requests</code> 库实现这两个方法。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 已购买课程可以使用 videoPlayerToken，但是我测试时候只能</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">videoPlayerToken</span><span class="token punctuation">(</span>courseId<span class="token punctuation">,</span> video_id<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     url <span class="token operator">=</span> <span class="token string">"https://www.xxxxxx.com:xxxx/web/bjvod/videoPlayerToken"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>     headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/plain, */*'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">'accept-encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">'area'</span><span class="token punctuation">:</span> <span class="token string">'0100000200'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">'companynum'</span><span class="token punctuation">:</span> <span class="token string">'01000002'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">'content-length'</span><span class="token punctuation">:</span> <span class="token string">'120'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/json; charset=UTF-8'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">'origin'</span><span class="token punctuation">:</span> <span class="token string">'https://www.xxxx.cn'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">'referer'</span><span class="token punctuation">:</span> <span class="token string">'https://www.xxxx.cn/'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span> <span class="token string">'" Not;A Brand";v="99", "Microsoft Edge";v="91", "Chromium";v="91"'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span> <span class="token string">'?0'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token string">'sec-fetch-dest'</span><span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token string">'sec-fetch-mode'</span><span class="token punctuation">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token string">'sec-fetch-site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token string">'token'</span><span class="token punctuation">:</span> <span class="token string">'xxxxxxxxxxxxxxxxxxxxxxUo2g'</span></pre></td></tr><tr><td data-num="20"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>     parameter <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token string">"courseId"</span><span class="token punctuation">:</span> courseId<span class="token punctuation">,</span>    <span class="token comment"># 课程 ID</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token string">"expires_in"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token string">"t"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token string">"video_id"</span><span class="token punctuation">:</span> video_id     <span class="token comment"># 课程 url (其实就是视频 id 号)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>     r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                             data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>     json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>     <span class="token keyword">if</span> <span class="token string">"data"</span> <span class="token keyword">in</span> json_str<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">return</span> json_str<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span></pre></td></tr></table></figure><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">getAllFormatPlayUrl</span><span class="token punctuation">(</span>vid<span class="token punctuation">,</span> tk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     url <span class="token operator">=</span> <span class="token string">"https://www.xxjiayun.com/vod/video/getAllFormatPlayUrl"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'accept-encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">'referer'</span><span class="token punctuation">:</span> <span class="token string">'https://www.sjqhedu.cn/'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span> <span class="token string">'" Not;A Brand";v="99", "Microsoft Edge";v="91", "Chromium";v="91"'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span> <span class="token string">'30'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">'sec-fetch-dest'</span><span class="token punctuation">:</span> <span class="token string">'script'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">'sec-fetch-mode'</span><span class="token punctuation">:</span> <span class="token string">'no-cors'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">'sec-fetch-site'</span><span class="token punctuation">:</span> <span class="token string">'cross-site'</span></pre></td></tr><tr><td data-num="13"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>     parameter <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token string">"vid"</span><span class="token punctuation">:</span> vid<span class="token punctuation">,</span>     <span class="token comment"># 课程 url (其实就是视频 id 号)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token string">"sid"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token string">"render"</span><span class="token punctuation">:</span> <span class="token string">"jsonp"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token string">"client_type"</span><span class="token punctuation">:</span> <span class="token string">"flash"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token string">"ver"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token string">"token"</span><span class="token punctuation">:</span> tk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token string">"callback"</span><span class="token punctuation">:</span> <span class="token string">"jQuery00000000_10000000009"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token string">"_"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>     r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                            params<span class="token operator">=</span>parameter<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>     dick_str <span class="token operator">=</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"jQuery00000000_10000000009("</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>     <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>dick_str<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="0x4-批量下载"><a class="anchor" href="#0x4-批量下载">#</a> 0x4 批量下载</h2><blockquote><p>机智的小刘同学认为：如果无法批量实现上面的操作下载视频，那么一切都是白费。</p></blockquote><p>稳妥的小刘同学决定先整理一下现在的思路</p><ol><li>获取当前课程全部视频的课程 ID 和 url</li><li>通过这两个参数获取 token</li><li>通过课程的 url 和 token 获取到加密视频直链</li><li>通过解密加密的直链获取到真正的视频直链地址</li><li>下载视频</li></ol><p>正是因为细心的小刘同学首先发现刚打开课程目录时候，就会返回所有课程的信息，这才有了他批量操作的信心。</p><p>刚打开课程首页，通过搜索课程的名称，机智的小刘同学发现了这个关键信息。</p><p><img data-src="2021-12-06T232043.png" alt="2021-12-06T232043"></p><p>懒惰的小刘没有再打算通过 api 获取这个 json 结果，而是直接复制的全部内容保存到了本地 json 文件。通过读取本地的 json 文件加载全部课程。</p><p>上面的结果保存到本地后，直接用 python 读取：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">getCourseList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'list1.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    t <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> t<span class="token punctuation">[</span><span class="token string">'syllabus'</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>到此为止我们就基本完成了全部的关键代码。</p><p>让我们最后实现 main 方法吧：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre>http <span class="token operator">=</span> urllib3<span class="token punctuation">.</span>PoolManager<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#下载视频使用 urllib3 库</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    course_list <span class="token operator">=</span> getCourseList<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 获取全部课程</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># with open("test.txt", "w") as f:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">for</span> courses <span class="token keyword">in</span> course_list<span class="token punctuation">:</span>    <span class="token comment"># 遍历课程（1 级目录）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>           path <span class="token operator">=</span> courses<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>           <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>              os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token comment"># 创建文件夹保存视频</span></pre></td></tr><tr><td data-num="9"></td><td><pre>              <span class="token keyword">for</span> course <span class="token keyword">in</span> courses<span class="token punctuation">[</span><span class="token string">"list"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment"># 遍历课程（2 级目录）/ 视频</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                   <span class="token comment"># print(course)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                   <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>course<span class="token punctuation">[</span><span class="token string">"list"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                       token <span class="token operator">=</span> videoPlayerToken<span class="token punctuation">(</span>courseId<span class="token operator">=</span>course<span class="token punctuation">[</span><span class="token string">"courseId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> video_id<span class="token operator">=</span>course<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 获取 token</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                       <span class="token keyword">if</span> token <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                           <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>                      json_url <span class="token operator">=</span> getAllFormatPlayUrl<span class="token punctuation">(</span>course<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>    <span class="token comment"># 获取加密的直链</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>                      mp4 <span class="token operator">=</span> json_url<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"all_format_play_info"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"mp4"</span><span class="token punctuation">]</span><span class="token comment"># 加密的直链的 MP4 的内容</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>                      <span class="token keyword">if</span> <span class="token string">'superHD'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                          d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"superHD"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span>    <span class="token comment"># 获取其中一个加密的地址</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                          r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span>           <span class="token comment"># 获取真实直链</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                          f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> course<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span>        <span class="token comment"># 下载视频病保存</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                          <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                          r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                          <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                           f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>              <span class="token comment"># 下面内容重复就不再有注释了</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>                      <span class="token keyword">if</span> <span class="token string">'high'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                          d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"high"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                          r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                          f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> course<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                          <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                          r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                          <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                           f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>                      <span class="token keyword">if</span> <span class="token string">'720p'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                          d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"720p"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                          r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                          f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> course<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                          <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                          r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                          <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                              f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>                   <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                      path <span class="token operator">=</span> courses<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> course<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                      <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                          os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                          <span class="token comment"># print(courses["name"].strip()+"/"+course["name"].strip())</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                      <span class="token keyword">for</span> c <span class="token keyword">in</span> course<span class="token punctuation">[</span><span class="token string">"list"</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                          token <span class="token operator">=</span> videoPlayerToken<span class="token punctuation">(</span>courseId<span class="token operator">=</span>c<span class="token punctuation">[</span><span class="token string">"courseId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> video_id<span class="token operator">=</span>c<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                          <span class="token keyword">if</span> token <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                              <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                          content <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> c<span class="token punctuation">[</span><span class="token string">"courseId"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> c<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> token</pre></td></tr><tr><td data-num="59"></td><td><pre>                          <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                          <span class="token comment"># worksheet.write(i, 0, label=c["name"])</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                          json_url <span class="token operator">=</span> getAllFormatPlayUrl<span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                          j <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                          mp4 <span class="token operator">=</span> json_url<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"all_format_play_info"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"mp4"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                          <span class="token keyword">print</span><span class="token punctuation">(</span>mp4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                          <span class="token keyword">if</span> <span class="token string">'superHD'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                              d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"superHD"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                              r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                              f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> c<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                              <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                              r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                              <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>                          <span class="token keyword">if</span> <span class="token string">'high'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                              d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"high"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                              r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                              f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> c<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                              <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                              r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                              <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                                  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>                          <span class="token keyword">if</span> <span class="token string">'720p'</span> <span class="token keyword">in</span> mp4<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                              d_url <span class="token operator">=</span> mp4<span class="token punctuation">[</span><span class="token string">"720p"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cdn_list"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enc_url"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                              r_url <span class="token operator">=</span> js_code<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">"decodeUrl"</span><span class="token punctuation">,</span> d_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                              f_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> course<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".mp4"</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                              <span class="token comment"># wget.download (r_url, path)# 下载</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                              r <span class="token operator">=</span> http<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> r_url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                              <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                                  f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token keyword">finally</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        r<span class="token punctuation">.</span>release_conn<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="2021-12-06T232103.png" alt="2021-12-06T232103"></p><p>最终，机智的小刘同学下载完成的全部的视频。</p><h2 id="0x5-总结"><a class="anchor" href="#0x5-总结">#</a> 0x5 总结</h2><p>整个过程中最关键的步骤就是获取到视频的加密真实链接的 API。<br>获取到关键的 API 后，我们需要做的就是凑齐 API 的参数，然后解密。</p><p>功夫不负有心人，机智的小刘同学完成了全部的需求。</p><h2 id="来源"><a class="anchor" href="#来源">#</a> 来源</h2><p><span class="exturl" data-url="aHR0cDovL2Jic3M5OS54eXovaW5kZXgucGhwLzIwMjEvMDcvMzAvJUU2JTlGJTkwJUU2JTg4JTkwJUU1JTlDJUE4JUU3JUJBJUJGJUU4JThFJUI3JUU1JThGJTk2JUU3JTlDJTlGJUU1JUFFJTlFJUU4JUE3JTg2JUU5JUEyJTkxJUU1JTlDJUIwJUU1JTlEJTgwLw==">http://bbss99.xyz/index.php/2021/07/30 / 某成在线获取真实视频地址 /</span></p><p>另一篇关于在线视频加密的文章：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1BNXzYwNS9hcnRpY2xlL2RldGFpbHMvODAwNzY4NTA/dXRtX3NvdXJjZT1ibG9neGd3ejA=">https://blog.csdn.net/PM_605/article/details/80076850?utm_source=blogxgwz0</span></p></div><footer><div class="meta"></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/Hugo%E4%B8%BB%E9%A2%98%E7%AD%9B%E9%80%89%E8%BF%87%E7%A8%8B/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;dd-static.jd.com&#x2F;ddimg&#x2F;jfs&#x2F;t1&#x2F;112337&#x2F;29&#x2F;14331&#x2F;743488&#x2F;614f26ccEffe96c9b&#x2F;ec38e7deda2ae109.jpg" title="Hugo主题筛选过程"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>Hugo主题筛选过程</h3></a></div><div class="item right"><a href="/2021/12/%E7%A6%81%E7%94%A8%E5%8D%8E%E4%B8%BA%E7%B3%BB%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%9B%B4%E6%96%B0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;dd-static.jd.com&#x2F;ddimg&#x2F;jfs&#x2F;t1&#x2F;204716&#x2F;24&#x2F;8174&#x2F;6224951&#x2F;614f2c21Eb584c978&#x2F;d3993a356b72b62d.jpg" title="禁用华为系手机系统更新"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>禁用华为系手机系统更新</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-f12-%E5%AF%BB%E6%89%BE%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">0x1 F12 寻找关键点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E9%80%9A%E8%BF%87-api-%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E5%9C%B0%E5%9D%80"><span class="toc-number">2.</span> <span class="toc-text">0x2 通过 API 获取视频地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6-getallformatplayurl"><span class="toc-number">3.</span> <span class="toc-text">0x3 深入探究 getAllFormatPlayUrl</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x31-%E8%8E%B7%E5%8F%96-token"><span class="toc-number">3.1.</span> <span class="toc-text">0x3.1 获取 token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x32-%E6%9E%84%E5%BB%BA%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">3.2.</span> <span class="toc-text">0x3.2 构建时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x33-%E7%94%A8-python-%E5%AE%9E%E7%8E%B0-getallformatplayurl-%E5%92%8C-playertoken"><span class="toc-number">3.3.</span> <span class="toc-text">0x3.3 用 python 实现 getAllFormatPlayUrl 和 playerToken</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-%E6%89%B9%E9%87%8F%E4%B8%8B%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">0x4 批量下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x5-%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">0x5 总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A5%E6%BA%90"><span class="toc-number">6.</span> <span class="toc-text">来源</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="黑麋鹿" data-src="/images/avatar.jpg"><p class="name" itemprop="name">黑麋鹿</p><div class="description" itemprop="description">折腾之路</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">217</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">54</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">141</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/Hugo%E4%B8%BB%E9%A2%98%E7%AD%9B%E9%80%89%E8%BF%87%E7%A8%8B/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/%E7%A6%81%E7%94%A8%E5%8D%8E%E4%B8%BA%E7%B3%BB%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%9B%B4%E6%96%B0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">889k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">13:28</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/amehime/hexo-theme-shoka" rel="noopener" target="_blank">Shoka</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/某成在线获取真实视频地址【转载备份】/",favicon:{show:"BlackELK",hide:"看看再走吧"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->