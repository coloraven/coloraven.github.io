<!-- build time:Sat Oct 22 2022 09:09:18 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://sirliu.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://sirliu.github.io/atom.xml"><link rel="alternate" type="application/json" href="https://sirliu.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CMicrosoft%20YaHei:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Python,FastAPI"><link rel="canonical" href="https://sirliu.github.io/2021/10/FastAPI%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E7%BF%BB%E8%AF%91/"><title>FastAPI容器使用说明翻译 - FastAPI | Black Elk = = 潛龍勿用</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">FastAPI容器使用说明翻译</h1><div class="meta"><span class="item" title="创建时间：2021-10-20 22:44:44"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-10-20T22:44:44+08:00">2021-10-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>5 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Black Elk</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=139891"></li><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=237229"></li><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=420106"></li><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=338684"></li><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=763178"></li><li class="item" data-background-image="https://randomimg.herokuapp.com/?source=wallhaven?id=970734"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/FastAPI/" itemprop="item" rel="index" title="分类于 FastAPI"><span itemprop="name">FastAPI</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sirliu.github.io/2021/10/FastAPI%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E7%BF%BB%E8%AF%91/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="黑麋鹿"><meta itemprop="description" content="潛龍勿用, 折腾之路"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><p>官方说明：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RpYW5nb2xvL3V2aWNvcm4tZ3VuaWNvcm4tZmFzdGFwaS1kb2NrZXIvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k">https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker/blob/master/README.md</span></p><h1 id="环境变量"><a class="anchor" href="#环境变量">#</a> 环境变量</h1><p>有多个环境变量可供设置，如果不指定，则会使用默认值。</p><h2 id="module_name指定要运行的主文件文件名python中也叫模块名"><a class="anchor" href="#module_name指定要运行的主文件文件名python中也叫模块名">#</a> <code>MODULE_NAME</code> —— 指定要运行的主文件文件名（Python 中也叫模块名）</h2><p>Python &quot;module&quot; (文件) Gunicorn, this module would contain the actual application in a variable.</p><p>默认为:</p><ul><li><code>app.main</code> —— 如果主文件路径为 <code>/app/app/main.py</code><br>或者</li><li><code>main</code> —— 如果主文件路径为 <code>/app/main.py</code></li></ul><p>打个比方，如果主文件路径为 <code>/app/custom_app/custom_main.py</code> , 那么你需要设置成这样:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">MODULE_NAME</span><span class="token operator">=</span><span class="token string">"custom_app.custom_main"</span> myimage</pre></td></tr></table></figure><h2 id="variable_name指定主文件中fastapi对象的变量名称"><a class="anchor" href="#variable_name指定主文件中fastapi对象的变量名称">#</a> <code>VARIABLE_NAME</code> —— 指定主文件中 <code>FastAPI()</code> 对象的变量名称</h2><p>默认是:</p><ul><li><code>app</code></li></ul><p>举个例子，如果你的主文件是这样的:</p><pre><code class="language-Python">from fastapi import FastAPI

api = FastAPI()

@api.get(&quot;/&quot;)
def read_root():
    return &#123;&quot;message&quot;: &quot;Hello world!&quot;&#125;
</code></pre><p>在上面的例子中， <code>FastAPI()</code> 对象的变量名为 <code>api</code> ，那么你需要这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">VARIABLE_NAME</span><span class="token operator">=</span><span class="token string">"api"</span> myimage</pre></td></tr></table></figure><h2 id="app_module这个环境变量可以直接实现上面两个环境变量的作用"><a class="anchor" href="#app_module这个环境变量可以直接实现上面两个环境变量的作用">#</a> <code>APP_MODULE</code> —— 这个环境变量可以直接实现上面两个环境变量的作用</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">APP_MODULE</span><span class="token operator">=</span><span class="token string">"custom_app.custom_main:api"</span> myimage</pre></td></tr></table></figure><h2 id="gunicorn_conf指定gunicorn配置文件路径"><a class="anchor" href="#gunicorn_conf指定gunicorn配置文件路径">#</a> <code>GUNICORN_CONF</code> —— 指定 GUNICORN 配置文件路径</h2><p>默认为:</p><ul><li><code>/app/gunicorn_conf.py</code> 如果在该路径存在则使用此处的</li><li><code>/app/app/gunicorn_conf.py</code> 如果在该路径存在则使用此处的</li><li><code>/gunicorn_conf.py</code> (容器作者在此处放入了默认配置文件)</li></ul><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">GUNICORN_CONF</span><span class="token operator">=</span><span class="token string">"/app/custom_gunicorn_conf.py"</span> myimage</pre></td></tr></table></figure><p>You can use the <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RpYW5nb2xvL3V2aWNvcm4tZ3VuaWNvcm4tZG9ja2VyL2Jsb2IvbWFzdGVyL2RvY2tlci1pbWFnZXMvZ3VuaWNvcm5fY29uZi5weQ==">config file</span> from this image as a starting point for yours.</p><h2 id="workers_per_core指定每个cpu核心的线程数"><a class="anchor" href="#workers_per_core指定每个cpu核心的线程数">#</a> <code>WORKERS_PER_CORE</code> —— 指定每个 CPU 核心的线程数</h2><p>This image will check how many CPU cores are available in the current server running your container.</p><p>It will set the number of workers to the number of CPU cores multiplied by this value.</p><p>默认为:</p><ul><li><code>1</code></li></ul><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">WORKERS_PER_CORE</span><span class="token operator">=</span><span class="token string">"3"</span> myimage</pre></td></tr></table></figure><p>If you used the value <code>3</code> in a server with 2 CPU cores, it would run 6 worker processes.</p><p>You can use floating point values too.</p><p>So, for example, if you have a big server (let's say, with 8 CPU cores) running several applications, and you have an ASGI application that you know won't need high performance. And you don't want to waste server resources. You could make it use <code>0.5</code> workers per CPU core. For example:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">WORKERS_PER_CORE</span><span class="token operator">=</span><span class="token string">"0.5"</span> myimage</pre></td></tr></table></figure><p>In a server with 8 CPU cores, this would make it start only 4 worker processes.</p><p><strong>Note</strong>: 默认为，if <code>WORKERS_PER_CORE</code> is <code>1</code> and the server has only 1 CPU core, instead of starting 1 single worker, it will start 2. This is to avoid bad performance and blocking applications (server application) on small machines (server machine/cloud/etc). This can be overridden using <code>WEB_CONCURRENCY</code> .</p><h2 id="max_workers"><a class="anchor" href="#max_workers">#</a> <code>MAX_WORKERS</code></h2><p>Set the maximum number of workers to use.</p><p>You can use it to let the image compute the number of workers automatically but making sure it's limited to a maximum.</p><p>This can be useful, for example, if each worker uses a database connection and your database has a maximum limit of open connections.</p><p>默认为 it's not set, meaning that it's unlimited.</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">MAX_WORKERS</span><span class="token operator">=</span><span class="token string">"24"</span> myimage</pre></td></tr></table></figure><p>This would make the image start at most 24 workers, independent of how many CPU cores are available in the server.</p><h2 id="web_concurrency"><a class="anchor" href="#web_concurrency">#</a> <code>WEB_CONCURRENCY</code></h2><p>Override the automatic definition of number of workers.</p><p>默认为:</p><ul><li>Set to the number of CPU cores in the current server multiplied by the environment variable <code>WORKERS_PER_CORE</code> . So, in a server with 2 cores, 默认为 it will be set to <code>2</code> .</li></ul><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">WEB_CONCURRENCY</span><span class="token operator">=</span><span class="token string">"2"</span> myimage</pre></td></tr></table></figure><p>This would make the image start 2 worker processes, independent of how many CPU cores are available in the server.</p><h2 id="host指定监听地址可限制请求地址"><a class="anchor" href="#host指定监听地址可限制请求地址">#</a> <code>HOST</code> —— 指定监听地址，可限制请求地址</h2><p>The &quot;host&quot; used by Gunicorn, the IP where Gunicorn will listen for requests.</p><p>It is the host inside of the container.</p><p>因此，如果你设置成 <code>127.0.0.1</code> , 那么将只能在容器中访问 <code>FastAPI</code> 服务.</p><p>默认为:</p><ul><li><code>0.0.0.0</code></li></ul><h2 id="port-指定监听端口貌似可以更改暴露端口默认为80"><a class="anchor" href="#port-指定监听端口貌似可以更改暴露端口默认为80">#</a> <code>PORT</code> —— 指定监听端口，貌似可以更改暴露端口，默认为 <code>80</code></h2><p>The port the container should listen on.</p><p>If you are running your container in a restrictive environment that forces you to use some specific port (like <code>8080</code> ) you can set it with this variable.</p><p>默认为:</p><ul><li><code>80</code></li></ul><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token string">"8080"</span> myimage</pre></td></tr></table></figure><h2 id="bind直接实现上面两个参数的效果"><a class="anchor" href="#bind直接实现上面两个参数的效果">#</a> <code>BIND</code> —— 直接实现上面两个参数的效果</h2><p>The actual host and port passed to Gunicorn.</p><p>默认为，set based on the variables <code>HOST</code> and <code>PORT</code> .</p><p>So, if you didn't change anything, it will be set 默认为 to:</p><ul><li><code>0.0.0.0:80</code></li></ul><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">BIND</span><span class="token operator">=</span><span class="token string">"0.0.0.0:8080"</span> myimage</pre></td></tr></table></figure><h2 id="log_level指定gunicorn日志的级别"><a class="anchor" href="#log_level指定gunicorn日志的级别">#</a> <code>LOG_LEVEL</code> —— 指定 <code>Gunicorn</code> 日志的级别</h2><p>The log level for Gunicorn.</p><p>One of:</p><ul><li><code>debug</code></li><li><code>info</code></li><li><code>warning</code></li><li><code>error</code></li><li><code>critical</code></li></ul><p>默认为 <code>info</code> .</p><p>If you need to squeeze more performance sacrificing logging, set it to <code>warning</code> , for example:</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span><span class="token string">"warning"</span> myimage</pre></td></tr></table></figure><h2 id="worker_class"><a class="anchor" href="#worker_class">#</a> <code>WORKER_CLASS</code></h2><p>The class to be used by Gunicorn for the workers.</p><p>默认为，set to <code>uvicorn.workers.UvicornWorker</code> .</p><p>The fact that it uses Uvicorn is what allows using ASGI applications like FastAPI and Starlette, and that is also what provides the maximum performance.</p><p>You probably shouldn't change it.</p><p>But if for some reason you need to use the alternative Uvicorn worker: <code>uvicorn.workers.UvicornH11Worker</code> you can set it with this environment variable.</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">WORKER_CLASS</span><span class="token operator">=</span><span class="token string">"uvicorn.workers.UvicornH11Worker"</span> myimage</pre></td></tr></table></figure><h2 id="timeout超时时间默认为120"><a class="anchor" href="#timeout超时时间默认为120">#</a> <code>TIMEOUT</code> —— 超时时间，默认为 <code>120</code> .</h2><p>Workers silent for more than this many seconds are killed and restarted.</p><p>Read more about it in the <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmd1bmljb3JuLm9yZy9lbi9zdGFibGUvc2V0dGluZ3MuaHRtbCN0aW1lb3V0">Gunicorn docs: timeout</span>.</p><p>Notice that Uvicorn and ASGI frameworks like FastAPI and Starlette are async, not sync. So it's probably safe to have higher timeouts than for sync workers.</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">TIMEOUT</span><span class="token operator">=</span><span class="token string">"20"</span> myimage</pre></td></tr></table></figure><h2 id="keep_alive保持连接时间默认为2"><a class="anchor" href="#keep_alive保持连接时间默认为2">#</a> <code>KEEP_ALIVE</code> —— 保持连接时间，默认为 <code>2</code> .</h2><p>The number of seconds to wait for requests on a Keep-Alive connection.</p><p>Read more about it in the <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmd1bmljb3JuLm9yZy9lbi9zdGFibGUvc2V0dGluZ3MuaHRtbCNrZWVwYWxpdmU=">Gunicorn docs: keepalive</span>.</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">KEEP_ALIVE</span><span class="token operator">=</span><span class="token string">"20"</span> myimage</pre></td></tr></table></figure><h2 id="graceful_timeout"><a class="anchor" href="#graceful_timeout">#</a> <code>GRACEFUL_TIMEOUT</code></h2><p>Timeout for graceful workers restart.</p><p>Read more about it in the <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmd1bmljb3JuLm9yZy9lbi9zdGFibGUvc2V0dGluZ3MuaHRtbCNncmFjZWZ1bC10aW1lb3V0">Gunicorn docs: graceful-timeout</span>.</p><p>默认为，set to <code>120</code> .</p><p>你可以这样设置:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">GRACEFUL_TIMEOUT</span><span class="token operator">=</span><span class="token string">"20"</span> myimage</pre></td></tr></table></figure><h2 id="access_log访问日志的记录方式和保存位置默认为-输出到容器日志中"><a class="anchor" href="#access_log访问日志的记录方式和保存位置默认为-输出到容器日志中">#</a> <code>ACCESS_LOG</code> —— 访问日志的记录方式和保存位置，默认为 <code>&quot;-&quot;</code> ，输出到容器日志中。</h2><p>如果你想禁用访问日志，将其设置为空值即可:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">ACCESS_LOG</span><span class="token operator">=</span> myimage</pre></td></tr></table></figure><h2 id="error_log错误日志默认为-输出到容器日志中"><a class="anchor" href="#error_log错误日志默认为-输出到容器日志中">#</a> <code>ERROR_LOG</code> —— 错误日志，默认为 <code>&quot;-&quot;</code> ，输出到容器日志中。</h2><p>如果你想禁用错误日志，将其设置为空值即可:</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -d -p <span class="token number">80</span>:8080 -e <span class="token assign-left variable">ERROR_LOG</span><span class="token operator">=</span> myimage</pre></td></tr></table></figure><div class="tags"><a href="/tags/Python/" rel="tag"><i class="ic i-tag"></i> Python</a> <a href="/tags/FastAPI/" rel="tag"><i class="ic i-tag"></i> FastAPI</a></div></div><footer><div class="meta"><span id="2021/10/FastAPI容器使用说明翻译/" class="item leancloud_visitors" data-flag-title="FastAPI容器使用说明翻译" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>黑麋鹿 <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://sirliu.github.io/2021/10/FastAPI%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E7%BF%BB%E8%AF%91/" title="FastAPI容器使用说明翻译">https://sirliu.github.io/2021/10/FastAPI容器使用说明翻译/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/10/pymongo%E6%93%8D%E4%BD%9C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;randomimg.herokuapp.com&#x2F;?source&#x3D;wallhaven?id&#x3D;180574" title="pymongo操作"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Python</span><h3>pymongo操作</h3></a></div><div class="item right"><a href="/2021/10/FastAPI%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;randomimg.herokuapp.com&#x2F;?source&#x3D;wallhaven?id&#x3D;431686" title="FastAPI直接使用请求与响应"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> FastAPI</span><h3>FastAPI直接使用请求与响应</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.</span> <span class="toc-text">环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#module_name%E6%8C%87%E5%AE%9A%E8%A6%81%E8%BF%90%E8%A1%8C%E7%9A%84%E4%B8%BB%E6%96%87%E4%BB%B6%E6%96%87%E4%BB%B6%E5%90%8Dpython%E4%B8%AD%E4%B9%9F%E5%8F%AB%E6%A8%A1%E5%9D%97%E5%90%8D"><span class="toc-number">1.1.</span> <span class="toc-text">MODULE_NAME —— 指定要运行的主文件文件名（Python 中也叫模块名）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#variable_name%E6%8C%87%E5%AE%9A%E4%B8%BB%E6%96%87%E4%BB%B6%E4%B8%ADfastapi%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D%E7%A7%B0"><span class="toc-number">1.2.</span> <span class="toc-text">VARIABLE_NAME —— 指定主文件中 FastAPI() 对象的变量名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#app_module%E8%BF%99%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%AE%9E%E7%8E%B0%E4%B8%8A%E9%9D%A2%E4%B8%A4%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">APP_MODULE —— 这个环境变量可以直接实现上面两个环境变量的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gunicorn_conf%E6%8C%87%E5%AE%9Agunicorn%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">1.4.</span> <span class="toc-text">GUNICORN_CONF —— 指定 GUNICORN 配置文件路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#workers_per_core%E6%8C%87%E5%AE%9A%E6%AF%8F%E4%B8%AAcpu%E6%A0%B8%E5%BF%83%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text">WORKERS_PER_CORE —— 指定每个 CPU 核心的线程数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#max_workers"><span class="toc-number">1.6.</span> <span class="toc-text">MAX_WORKERS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web_concurrency"><span class="toc-number">1.7.</span> <span class="toc-text">WEB_CONCURRENCY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#host%E6%8C%87%E5%AE%9A%E7%9B%91%E5%90%AC%E5%9C%B0%E5%9D%80%E5%8F%AF%E9%99%90%E5%88%B6%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80"><span class="toc-number">1.8.</span> <span class="toc-text">HOST —— 指定监听地址，可限制请求地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#port-%E6%8C%87%E5%AE%9A%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3%E8%B2%8C%E4%BC%BC%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%94%B9%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3%E9%BB%98%E8%AE%A4%E4%B8%BA80"><span class="toc-number">1.9.</span> <span class="toc-text">PORT —— 指定监听端口，貌似可以更改暴露端口，默认为 80</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind%E7%9B%B4%E6%8E%A5%E5%AE%9E%E7%8E%B0%E4%B8%8A%E9%9D%A2%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E6%95%88%E6%9E%9C"><span class="toc-number">1.10.</span> <span class="toc-text">BIND —— 直接实现上面两个参数的效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#log_level%E6%8C%87%E5%AE%9Agunicorn%E6%97%A5%E5%BF%97%E7%9A%84%E7%BA%A7%E5%88%AB"><span class="toc-number">1.11.</span> <span class="toc-text">LOG_LEVEL —— 指定 Gunicorn 日志的级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#worker_class"><span class="toc-number">1.12.</span> <span class="toc-text">WORKER_CLASS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timeout%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E9%BB%98%E8%AE%A4%E4%B8%BA120"><span class="toc-number">1.13.</span> <span class="toc-text">TIMEOUT —— 超时时间，默认为 120 .</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keep_alive%E4%BF%9D%E6%8C%81%E8%BF%9E%E6%8E%A5%E6%97%B6%E9%97%B4%E9%BB%98%E8%AE%A4%E4%B8%BA2"><span class="toc-number">1.14.</span> <span class="toc-text">KEEP_ALIVE —— 保持连接时间，默认为 2 .</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#graceful_timeout"><span class="toc-number">1.15.</span> <span class="toc-text">GRACEFUL_TIMEOUT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#access_log%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97%E7%9A%84%E8%AE%B0%E5%BD%95%E6%96%B9%E5%BC%8F%E5%92%8C%E4%BF%9D%E5%AD%98%E4%BD%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E4%B8%BA-%E8%BE%93%E5%87%BA%E5%88%B0%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E4%B8%AD"><span class="toc-number">1.16.</span> <span class="toc-text">ACCESS_LOG —— 访问日志的记录方式和保存位置，默认为 &quot;-&quot; ，输出到容器日志中。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#error_log%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E9%BB%98%E8%AE%A4%E4%B8%BA-%E8%BE%93%E5%87%BA%E5%88%B0%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E4%B8%AD"><span class="toc-number">1.17.</span> <span class="toc-text">ERROR_LOG —— 错误日志，默认为 &quot;-&quot; ，输出到容器日志中。</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2021/10/FastAPI%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E7%BF%BB%E8%AF%91/" rel="bookmark" title="FastAPI容器使用说明翻译">FastAPI容器使用说明翻译</a></li><li><a href="/2021/10/FastAPI%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/" rel="bookmark" title="FastAPI直接使用请求与响应">FastAPI直接使用请求与响应</a></li><li><a href="/2021/11/FastAPI%E8%BF%94%E5%9B%9E%E5%9B%BE%E7%89%87%E8%B8%A9%E5%9D%91/" rel="bookmark" title="FastAPI返回图片踩坑">FastAPI返回图片踩坑</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="黑麋鹿" data-src="/images/avatar.jpg"><p class="name" itemprop="name">黑麋鹿</p><div class="description" itemprop="description">折腾之路</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">174</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">32</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">84</span> <span class="name">标签</span></a></div></nav><div class="social"><a href="https://github.com/sirliu" title="https:&#x2F;&#x2F;github.com&#x2F;sirliu" class="item github" rel="noopener" target="_blank"><i class="ic i-github"></i></a> <a href="https://twitter.com/" title="https:&#x2F;&#x2F;twitter.com&#x2F;" class="item twitter" rel="noopener" target="_blank"><i class="ic i-twitter"></i></a> <a href="https://www.zhihu.com/" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;" class="item zhihu" rel="noopener" target="_blank"><i class="ic i-zhihu"></i></a> <a href="https://music.163.com/" title="https:&#x2F;&#x2F;music.163.com&#x2F;" class="item music" rel="noopener" target="_blank"><i class="ic i-cloud-music"></i></a> <a href="https://weibo.com/" title="https:&#x2F;&#x2F;weibo.com&#x2F;" class="item weibo" rel="noopener" target="_blank"><i class="ic i-weibo"></i></a> <a href="mailto:yourname@mail.com" title="mailto:yourname@mail.com" class="item email" rel="noopener" target="_blank"><i class="ic i-envelope"></i></a> <a href="https://www.facebook.com/" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;" class="item facebook" rel="noopener" target="_blank"><i class="ic i-facebook"></i></a> <a href="https://stackoverflow.com/" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;" class="item stackoverflow" rel="noopener" target="_blank"><i class="ic i-stack-overflow"></i></a> <a href="https://www.youtube.com/" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;" class="item youtube" rel="noopener" target="_blank"><i class="ic i-youtube"></i></a> <a href="https://instagram.com/" title="https:&#x2F;&#x2F;instagram.com&#x2F;" class="item instagram" rel="noopener" target="_blank"><i class="ic i-instagram"></i></a> <a href="skype:yourname?call|chat" title="skype:yourname?call|chat" class="item skype" rel="noopener" target="_blank"><i class="ic i-skype"></i></a> <a href="https://www.douban.com/" title="https:&#x2F;&#x2F;www.douban.com&#x2F;" class="item douban" rel="noopener" target="_blank"><i class="ic i-douban"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/10/pymongo%E6%93%8D%E4%BD%9C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/10/FastAPI%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">黑麋鹿 @ Black Elk</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">689k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:26</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/amehime/hexo-theme-shoka" rel="noopener" target="_blank">Shoka</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/10/FastAPI容器使用说明翻译/",favicon:{show:"BlackELK",hide:"看看再走吧"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->